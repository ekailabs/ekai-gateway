services:
  fullstack:
    build: .
    image: ghcr.io/ekailabs/ekai-gateway:latest
    environment:
      UI_PORT: ${UI_PORT:-3000}
      OPENROUTER_PORT: ${OPENROUTER_PORT:-4010}
      NEXT_PUBLIC_API_BASE_URL: ${NEXT_PUBLIC_API_BASE_URL:-http://localhost:4010}
      NEXT_PUBLIC_MEMORY_PORT: ${OPENROUTER_PORT:-4010}
      MEMORY_DB_PATH: /app/memory/data/memory.db
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY:-}
      ENABLE_DASHBOARD: ${ENABLE_DASHBOARD:-true}
      ENABLE_OPENROUTER: ${ENABLE_OPENROUTER:-true}
    ports:
      - "3000:3000"
      - "4010:4010"
    volumes:
      - memory_db:/app/memory/data
    restart: unless-stopped

  openrouter-standalone:
    build:
      context: .
      target: openrouter-cloudrun
    image: ghcr.io/ekailabs/ekai-openrouter:latest
    profiles: [cloudrun]
    environment:
      PORT: ${OPENROUTER_PORT:-4010}
      MEMORY_DB_PATH: /app/memory/data/memory.db
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY:-}
      DASHBOARD_STATIC_DIR: /app/dashboard-static
    ports:
      - "4010:4010"
    volumes:
      - memory_db:/app/memory/data
    restart: unless-stopped

volumes:
  memory_db:
